<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ziel-ROAS Rechner (inkl. CLV)</title>
<style>
  :root{
    --blue:#0071e3;
    --muted:#6b7280;
    --bg:#f4f6f9;
    --card:#ffffff;
    --input-bg:#f9f9fb;
    --radius:12px;
    --gap:14px;
    font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial,Helvetica, sans-serif;
    color-scheme: light;
  }
  html,body{height:100%;margin:0;background:var(--bg)}
  .wrap{max-width:980px;margin:32px auto;padding:20px}
  .card{
    background:var(--card);
    border-radius:20px;
    padding:28px;
    box-shadow:0 10px 30px rgba(2,6,23,0.06);
  }
  h1{margin:0 0 6px;font-size:20px;text-align:center;color:#0f172a}
  p.lead{margin:0 0 18px;text-align:center;color:var(--muted)}
  .grid{
    display:flex;
    gap:24px;
    align-items:flex-start;
    flex-wrap:wrap;
  }
  .col{flex:1;min-width:300px}
  h2.section-title{margin:0 0 12px;font-size:14px;color:var(--blue)}
  .field{display:flex;flex-direction:column;margin-bottom:10px}
  label{font-size:13px;color:#0f172a;margin-bottom:6px;margin-top:6px}
  input[type=number], input[type=text]{
    height:44px;padding:10px 12px;border-radius:10px;border:1px solid #e6e9ef;background:var(--input-bg);
    font-size:14px;box-sizing:border-box;
  }
  input[readonly]{background:#f1f5f9;}
  input:focus{outline:none;border-color:var(--blue);box-shadow:0 6px 20px rgba(11,99,255,0.06)}
  /* special blue outline only for retention & years (visual only) */
  .blue-outline { border-color: var(--blue); box-shadow: 0 6px 20px rgba(11,99,255,0.06); }
  .inline-row{display:flex;gap:12px}
  .inline-row > div{flex:1}
  .live{margin-top:12px}
  .live label{margin-top:10px}
  .live-value{font-weight:700;color:var(--blue);font-size:18px;margin-top:6px}
  .btn-main{display:block;width:100%;padding:12px;border-radius:12px;border:none;background:var(--blue);color:white;font-weight:700;font-size:15px;cursor:pointer;margin-top:12px}
  .btn-main:hover{background:#005ec1}
  /* results */
  .results{margin-top:18px;display:none}
  .results-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .result-card{background:#f7fbff;padding:12px;border-radius:12px;display:flex;flex-direction:column;justify-content:center;min-height:74px}
  .result-title{font-size:13px;color:#0f172a;margin-bottom:6px}
  .result-value{font-weight:700;font-size:18px;color:var(--blue)}
  .result-value.gray{color:#6b7280}
  /* footer / embed */
  .footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:20px;flex-wrap:wrap}
  .footer .meta{color:var(--muted);font-size:13px}
  .footer a.brand{color:var(--muted);text-decoration:none}
  .embed-panel{display:none;margin-top:12px}
  .embed-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .embed-row input[type=number]{width:110px}
  textarea#embedCode{width:100%;min-height:80px;padding:10px;border-radius:8px;border:1px solid #ddd;font-family:monospace;box-sizing:border-box;margin-top:8px}
  .small-muted{font-size:13px;color:var(--muted);margin-top:8px}
  /* responsive */
  @media (max-width:740px){
    .grid{flex-direction:column}
    .results-grid{grid-template-columns:1fr}
    .embed-row{flex-direction:column;align-items:stretch}
    .embed-row input[type=number]{width:100%}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Ziel-ROAS Rechner">
      <h1>Break-Even ROAS Rechner</h1>
      <p class="lead">Brutto eingeben → Netto automatisch. CLV-Erweiterung addiert Ertrag von Stammkunden anteilig auf Erstkauf.</p>

      <div class="grid" id="mainGrid">
        <!-- left column: Grunddaten -->
        <div class="col" id="col-left">
          <h2 class="section-title">Grunddaten (pro Bestellung)</h2>

          <div class="field">
            <label for="gross">Bruttoumsatz pro Bestellung (€)</label>
            <input id="gross" type="number" step="0.01" placeholder="z. B. 59.50" />
          </div>

          <div class="field">
            <label for="net">Nettoumsatz (automatisch)</label>
            <input id="net" type="text" readonly />
          </div>

          <div class="field">
            <label for="prodCost">Herstellungskosten pro Bestellung (€)</label>
            <input id="prodCost" type="number" step="0.01" placeholder="z. B. 15" />
          </div>

          <div class="field">
            <label for="shipCost">Versand / Verpackung pro Bestellung (€)</label>
            <input id="shipCost" type="number" step="0.01" placeholder="z. B. 5" />
          </div>

          <div class="field">
            <label for="fixedCosts">Fixkosten (optional, pro Zeitraum in €)</label>
            <input id="fixedCosts" type="number" step="0.01" placeholder="z. B. 0" />
          </div>

          <div class="live" aria-live="polite">
            <label>Ertrag pro Kunde (Erstkauf, Netto)</label>
            <div id="profitFirst" class="live-value">–</div>
          </div>
        </div>

        <!-- right column: CLV -->
        <div class="col" id="col-right">
          <h2 class="section-title">CLV / Stammkunden (pro Neukunde)</h2>

          <div class="field">
            <label for="repeatGross">Brutto-Umsatz Stammkunde pro Jahr (€)</label>
            <input id="repeatGross" type="number" step="0.01" placeholder="z. B. 59.50" />
          </div>

          <div class="field">
            <label for="repeatNet">Nettoumsatz Stammkunde (automatisch)</label>
            <input id="repeatNet" type="text" readonly />
          </div>

          <div class="field">
            <label for="repeatProd">Herstellungskosten pro Jahr (€)</label>
            <input id="repeatProd" type="number" step="0.01" placeholder="z. B. 15" />
          </div>

          <div class="field">
            <label for="repeatShip">Versandkosten pro Jahr (€)</label>
            <input id="repeatShip" type="number" step="0.01" placeholder="z. B. 5" />
          </div>

          <div class="inline-row" style="margin-top:6px;">
            <div>
              <label for="retention">Anteil, die Stammkunden werden (%)</label>
              <input id="retention" type="number" step="0.1" placeholder="z. B. 50" />
            </div>
            <div>
              <label for="years">Betrachtungszeitraum (Jahre)</label>
              <input id="years" type="number" step="1" placeholder="z. B. 1" />
            </div>
          </div>

          <div class="live" aria-live="polite">
            <label>Ertrag Stammkunden (Netto, anteilig über Zeitraum)</label>
            <div id="profitRepeat" class="live-value">–</div>
          </div>
        </div>
      </div>

      <button class="btn-main" id="calcBtn" type="button">Berechnen</button>

      <!-- Results -->
      <div class="results" id="results">
        <div class="results-grid">
          <div class="result-card">
            <div class="result-title">Break-even ROAS (Erstkauf)</div>
            <div id="roasFirst" class="result-value">–</div>
          </div>
          <div class="result-card">
            <div class="result-title">Break-even ROAS (mit CLV)</div>
            <div id="roasClv" class="result-value gray">–</div>
          </div>
          <div class="result-card">
            <div class="result-title">Maximale Kosten pro Kunde (Erstkauf)</div>
            <div id="maxCostFirst" class="result-value gray">–</div>
          </div>
          <div class="result-card">
            <div class="result-title">Maximale Kosten pro Kunde (inkl. CLV)</div>
            <div id="maxCostClv" class="result-value gray">–</div>
          </div>
        </div>
      </div>

      <!-- embed area (hidden until requested) -->
      <div class="footer" style="margin-top:22px;">
        <div class="meta">
          <span style="font-size:13px;color:var(--muted)">Tool entwickelt von </span>
          <a class="brand" href="https://www.purple-noon.de" target="_blank" rel="noopener">Purple Noon</a>
        </div>

        <div>
          <button id="showEmbed" style="background:transparent;border:1px solid var(--blue);color:var(--blue);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600">
            Rechner einbetten / teilen
          </button>
        </div>
      </div>

      <div class="embed-panel" id="embedPanel" aria-hidden="true" style="margin-top:12px">
        <div class="embed-row" style="align-items:center;justify-content:flex-end">
          <label class="small-muted" for="iframeHeight">Höhe (px)</label>
          <input id="iframeHeight" type="number" value="950" min="200" />
          <button id="copyEmbed" style="background:var(--blue);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600">Code kopieren</button>
        </div>
        <textarea id="embedCode" readonly style="margin-top:8px"></textarea>
        <div class="small-muted">Kopiere den iFrame-Code und füge ihn auf anderen Seiten ein. Dein Footer-Link bleibt sichtbar.</div>
      </div>

    </div> <!-- .card -->
  </div> <!-- .wrap -->

<script>
/* Helper formatting */
function fmt(x){ return (Math.round(x*100)/100).toFixed(2); }

/* Elements */
const grossEl = document.getElementById('gross');
const netEl = document.getElementById('net');
const prodCostEl = document.getElementById('prodCost');
const shipCostEl = document.getElementById('shipCost');
const fixedCostsEl = document.getElementById('fixedCosts');

const repeatGrossEl = document.getElementById('repeatGross');
const repeatNetEl = document.getElementById('repeatNet');
const repeatProdEl = document.getElementById('repeatProd');
const repeatShipEl = document.getElementById('repeatShip');
const retentionEl = document.getElementById('retention');
const yearsEl = document.getElementById('years');

const profitFirstEl = document.getElementById('profitFirst');
const profitRepeatEl = document.getElementById('profitRepeat');

const roasFirstEl = document.getElementById('roasFirst');
const roasClvEl = document.getElementById('roasClv');
const maxCostFirstEl = document.getElementById('maxCostFirst');
const maxCostClvEl = document.getElementById('maxCostClv');

const resultsWrap = document.getElementById('results');

const showEmbedBtn = document.getElementById('showEmbed');
const embedPanel = document.getElementById('embedPanel');
const iframeHeightEl = document.getElementById('iframeHeight');
const embedCodeEl = document.getElementById('embedCode');
const copyEmbedBtn = document.getElementById('copyEmbed');

/* VAT factor (example 19%). If you use other VAT, change here. */
const VAT = 1.19;

/* Live updates for Netto + live profits */
function updateNettoAndLive(){
  const gross = parseFloat(grossEl.value) || 0;
  const net = gross / VAT;
  netEl.value = net ? fmt(net) : '';
  updateLiveProfitFirst();
  updateLiveCLV();
}

function updateLiveProfitFirst(){
  const net = parseFloat(netEl.value) || 0;
  const prod = parseFloat(prodCostEl.value) || 0;
  const ship = parseFloat(shipCostEl.value) || 0;
  const fixed = parseFloat(fixedCostsEl.value) || 0;
  const profitFirst = net - prod - ship - fixed;
  profitFirstEl.textContent = isFinite(profitFirst) ? (fmt(profitFirst) + ' €') : '–';
}

function updateLiveCLV(){
  const net = parseFloat(netEl.value) || 0;
  const retention = (parseFloat(retentionEl.value) || 0) / 100;
  const repeatGross = parseFloat(repeatGrossEl.value) || 0;
  const repeatNet = repeatGross / VAT;
  repeatNetEl.value = repeatNet ? fmt(repeatNet) : '';
  const repeatProd = parseFloat(repeatProdEl.value) || 0;
  const repeatShip = parseFloat(repeatShipEl.value) || 0;
  const years = parseFloat(yearsEl.value) || 0;

  const profitPerRepeat = (repeatNet - repeatProd - repeatShip) * retention * years;
  profitRepeatEl.textContent = isFinite(profitPerRepeat) ? (fmt(profitPerRepeat) + ' €') : '–';
}

/* Main calculation for ROAS */
function calc(){
  const net = parseFloat(netEl.value) || 0;
  if (net <= 0) {
    alert('Bitte Bruttoumsatz eingeben (links oben).');
    return;
  }
  const prod = parseFloat(prodCostEl.value) || 0;
  const ship = parseFloat(shipCostEl.value) || 0;
  const fixed = parseFloat(fixedCostsEl.value) || 0;

  const profitFirst = net - prod - ship - fixed;
  const marginFirst = profitFirst / net;
  const roasFirst = (marginFirst > 0) ? (1 / marginFirst) : Infinity;

  const retention = (parseFloat(retentionEl.value) || 0) / 100;
  const repeatNet = parseFloat(repeatNetEl.value) || 0;
  const repeatProd = parseFloat(repeatProdEl.value) || 0;
  const repeatShip = parseFloat(repeatShipEl.value) || 0;
  const years = parseFloat(yearsEl.value) || 0;

  const profitRepeat = (repeatNet - repeatProd - repeatShip) * retention * years;
  const totalProfit = profitFirst + profitRepeat;
  const marginTotal = totalProfit / net;
  const roasClv = (marginTotal > 0) ? (1 / marginTotal) : Infinity;

  // Fill UI
  profitFirstEl.textContent = isFinite(profitFirst) ? (fmt(profitFirst) + ' €') : '–';
  profitRepeatEl.textContent = isFinite(profitRepeat) ? (fmt(profitRepeat) + ' €') : '–';
  roasFirstEl.textContent = isFinite(roasFirst) ? fmt(roasFirst) + 'x' : '–';
  roasClvEl.textContent = isFinite(roasClv) ? fmt(roasClv) + 'x' : '–';
  maxCostFirstEl.textContent = isFinite(profitFirst) ? (fmt(profitFirst) + ' €') : '–';
  maxCostClvEl.textContent = isFinite(totalProfit) ? (fmt(totalProfit) + ' €') : '–';

  resultsWrap.style.display = 'block';
}

/* Embed panel logic */
function openEmbedPanel(){
  const isHidden = embedPanel.style.display === '' || embedPanel.style.display === 'none';
  embedPanel.style.display = isHidden ? 'block' : 'none';
  if (isHidden) generateEmbedCode();
}
function generateEmbedCode(){
  const height = parseInt(iframeHeightEl.value) || 950;
  // Replace YOUR_GITHUB_USERNAME with your actual GitHub username or host domain before publishing.
  const src = `https://YOUR_GITHUB_USERNAME.github.io/roas-rechner/`;
  const code = `<iframe src="${src}" width="100%" height="${height}" style="border:none;"></iframe>`;
  embedCodeEl.value = code;
}
function copyEmbed(){
  const code = embedCodeEl.value;
  if (!code) { generateEmbedCode(); }
  // Clipboard API with fallback
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(embedCodeEl.value).then(()=> {
      copyEmbedBtn.textContent = 'Kopiert ✓';
      setTimeout(()=>copyEmbedBtn.textContent='Code kopieren',1400);
    }).catch(()=> fallbackCopy());
  } else fallbackCopy();

  function fallbackCopy(){
    embedCodeEl.select();
    try {
      document.execCommand('copy');
      copyEmbedBtn.textContent = 'Kopiert ✓';
      setTimeout(()=>copyEmbedBtn.textContent='Code kopieren',1400);
    } catch(e) {
      alert('Kopieren fehlgeschlagen — bitte manuell markieren und kopieren.');
    }
  }
}

/* Attach events */
grossEl.addEventListener('input', updateNettoAndLive);
prodCostEl.addEventListener('input', updateLiveProfitFirst);
shipCostEl.addEventListener('input', updateLiveProfitFirst);
fixedCostsEl.addEventListener('input', updateLiveProfitFirst);

repeatGrossEl.addEventListener('input', updateLiveCLV);
repeatProdEl.addEventListener('input', updateLiveCLV);
repeatShipEl.addEventListener('input', updateLiveCLV);
retentionEl.addEventListener('input', function(){ retentionEl.classList.add('blue-outline'); updateLiveCLV(); });
yearsEl.addEventListener('input', function(){ yearsEl.classList.add('blue-outline'); updateLiveCLV(); });

document.getElementById('calcBtn').addEventListener('click', calc);
showEmbedBtn.addEventListener('click', openEmbedPanel);
iframeHeightEl.addEventListener('input', generateEmbedCode);
copyEmbedBtn.addEventListener('click', copyEmbed);

/* init */
updateNettoAndLive();
updateLiveCLV();
</script>
</body>
</html>
